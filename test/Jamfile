# Copyright 2025 Matt Borland
# Distributed under the Boost Software License, Version 1.0.
# https://www.boost.org/LICENSE_1_0.txt

require-b2 5.0.1 ;
import-search /boost/config/checks ;
import config : requires ;
import modules ;
import testing ;

project : requirements

    <warnings>extra

    <toolset>gcc:<cxxflags>-Wsign-conversion
    <toolset>gcc:<cxxflags>-Wconversion
    <toolset>gcc:<cxxflags>-Wundef
    <toolset>gcc:<cxxflags>-Wold-style-cast
    <toolset>gcc:<cxxflags>-Wfloat-equal
    <toolset>gcc:<cxxflags>-Wshadow
    <toolset>gcc:<cxxflags>-Wcast-qual
    <toolset>gcc:<cxxflags>-Wcast-align
    <toolset>gcc:<cxxflags>-Wlogical-op
    <toolset>gcc:<cxxflags>-Wdouble-promotion
    <toolset>gcc:<cxxflags>-Wformat=2
    <toolset>gcc:<cxxflags>-Wstack-protector

    <toolset>clang:<cxxflags>-Wsign-conversion
    <toolset>clang:<cxxflags>-Wconversion
    <toolset>clang:<cxxflags>-Wundef
    <toolset>clang:<cxxflags>-Wold-style-cast
    <toolset>clang:<cxxflags>-Wfloat-equal
    <toolset>clang:<cxxflags>-Wshadow
    <toolset>clang:<cxxflags>-Wcast-qual
    <toolset>clang:<cxxflags>-Wcast-align
    <toolset>clang:<cxxflags>-Wdouble-promotion
    <toolset>clang:<cxxflags>-Wformat=2
    <toolset>clang:<cxxflags>-Wnull-dereference
    <toolset>clang:<cxxflags>-Wthread-safety
    <toolset>clang:<cxxflags>-Wunused-lambda-capture
    <toolset>clang:<cxxflags>-Wassign-enum

    <toolset>msvc:<warnings-as-errors>on
    <toolset>clang:<warnings-as-errors>on
    <toolset>gcc:<warnings-as-errors>on

  [ requires cxx20_hdr_bit cxx20_hdr_compare cxx20_hdr_concepts ]
  ;

run quick.cpp ;

run test_unsigned_construction.cpp ;
compile compile_integer_type_properties.cpp ;
run test_unsigned_narrowing_conversions.cpp ;

run test_unsigned_addition.cpp ;
compile-fail compile_fail_unsigned_addition.cpp ;
run-fail benchmarks/benchmark_unsigned_operations.cpp ;
run-fail benchmarks/benchmark_boost.cpp ;
run test_limits.cpp ;
run limits_link_1.cpp limits_link_2.cpp limits_link_3.cpp ;
compile-fail compile_fail_unsigned_construction_from_bool.cpp ;
run test_unsigned_streaming.cpp ;
run test_unsigned_literals.cpp ;
compile-fail compile_fail_unsigned_literals.cpp ;
run test_unsigned_subtraction.cpp ;
run test_unsigned_multiplication.cpp ;
run test_unsigned_division.cpp ;
run test_unsigned_modulo.cpp ;
run test_unsigned_inc_dec.cpp ;
run test_unsigned_std_format.cpp ;
run test_unsigned_fmt_format.cpp ;
run test_unsigned_charconv.cpp ;
run test_bit.cpp ;
run test_unsigned_bitwise_ops.cpp ;
compile-fail compile_fail_unsigned_unary_operators.cpp ;
run test_unsigned_saturating_addition.cpp ;
run test_unsigned_comparisons.cpp ;
run test_unsigned_saturating_subtraction.cpp ;
run test_unsigned_saturating_multiplication.cpp ;
run test_unsigned_saturating_division.cpp ;
run test_unsigned_saturating_mod.cpp ;
run test_unsigned_overflowing_addition.cpp ;
run test_unsigned_overflowing_subtraction.cpp ;
run test_unsigned_overflowing_multiplication.cpp ;
run test_unsigned_overflowing_division.cpp ;
run test_unsigned_overflowing_mod.cpp ;
run test_unsigned_checked_addition.cpp ;
run test_unsigned_checked_subtraction.cpp ;
run test_unsigned_checked_multiplication.cpp ;
run test_unsigned_checked_division.cpp ;
run test_unsigned_checked_mod.cpp ;
run test_unsigned_wrapping_addition.cpp ;
run test_unsigned_wrapping_subtraction.cpp ;
run test_unsigned_wrapping_multiplication.cpp ;
run test_unsigned_wrapping_division.cpp ;
run test_unsigned_wrapping_mod.cpp ;
run-fail test_unsigned_strict_addition.cpp ;
run-fail test_unsigned_strict_subtraction.cpp ;
run-fail test_unsigned_strict_multiplication.cpp ;
run-fail test_unsigned_strict_division.cpp ;
run-fail test_unsigned_strict_mod.cpp ;

# Exhaustive verification tests
run test_exhaustive_u8_arithmetic.cpp ;
run test_boundary_arithmetic.cpp ;
run test_unsigned_bounded_construction.cpp ;
run test_unsigned_bounded_addition.cpp ;
run test_unsigned_bounded_subtraction.cpp ;
run test_unsigned_bounded_multiplication.cpp ;
run test_unsigned_bounded_division.cpp ;
run test_unsigned_bounded_modulo.cpp ;
run test_unsigned_bounded_conversions.cpp ;
run test_unsigned_bounded_charconv.cpp ;
run test_unsigned_bounded_fmt_format.cpp ;
run test_unsigned_bounded_std_format.cpp ;
compile-fail compile_fail_bounded_mixed_ops.cpp ;
compile-fail compile_fail_bounded_bool_bounds.cpp ;

run test_verified_integers.cpp ;
run test_verified_streaming.cpp ;
run test_verified_bit.cpp ;
run test_verified_charconv.cpp ;
run test_verified_fmt_format.cpp ;
run test_verified_std_format.cpp ;

# Compile Tests
compile compile_tests/compile_test_unsigned_integers.cpp ;
compile compile_tests/compile_test_iostream.cpp ;
compile compile_tests/compile_test_main_header.cpp ;
compile compile_tests/compile_test_format.cpp ;
compile compile_tests/compile_test_limits.cpp ;
compile compile_tests/compile_test_literals.cpp ;
compile compile_tests/compile_test_charconv.cpp ;

# Run the examples
run ../examples/basic_usage.cpp ;
compile-fail ../examples/compile_fail_basic_usage_constexpr.cpp ;
run ../examples/debugger.cpp ;
run ../examples/construction_and_conversion.cpp ;
run ../examples/saturating_arithmetic.cpp ;
run ../examples/overflowing_arithmetic.cpp ;
run ../examples/checked_arithmetic.cpp ;
run ../examples/wrapping_arithmetic.cpp ;
run ../examples/strict_arithmetic.cpp ;
run ../examples/generic_arithmetic.cpp ;
run ../examples/literals.cpp ;
run ../examples/fmt_format.cpp ;
run ../examples/iostream.cpp ;
run ../examples/charconv.cpp ;
run ../examples/bit.cpp ;
run ../examples/bounded_limits.cpp ;
run ../examples/bitwise_ops.cpp ;
